# API Contract: Question Generation

## Overview
This API endpoint generates academic questions based on selected concepts and configuration. It uses LLMs to generate content and stores the results in the database (Supabase), returning the generated questions to the client.

**Endpoint:** `POST /api/v1/generate/questions`  
**Content-Type:** `application/json`

---

## 1. Request Format

The frontend sends the context (activity, concepts) and the desired configuration (counts per type, difficulty distribution).

### JSON Schema

```json
{
  "activity_id": "string (UUID)",
  "concept_ids": ["string (UUID)"],
  "config": {
    "question_types": [
      {
        "type": "string (enum)",
        "count": "integer"
      }
    ],
    "difficulty_distribution": {
      "easy": "integer (percentage 0-100)",
      "medium": "integer (percentage 0-100)",
      "hard": "integer (percentage 0-100)"
    }
  }
}
```

### Field Descriptions

| Field | Type | Description |
|---|---|---|
| `activity_id` | UUID | The ID of the current activity session. Used to link generated questions to the user's workspace. |
| `concept_ids` | Array[UUID] | List of specific concept IDs to generate questions from. The backend should recursively fetch context for these concepts (e.g., topic, chapter names) if needed for the prompt. |
| `config.question_types` | Array[Object] | List of desired question types and their exact counts. |
| `config.difficulty_distribution` | Object | Desired distribution of difficulty. Values should sum to roughly 100. |

### Enum: Question Types
*   `MCQ`
*   `SHORT_ANSWER`
*   `LONG_ANSWER`
*   `TRUE_FALSE`
*   `FILL_IN_THE_BLANK`

### Example Request

```json
{
  "activity_id": "123e4567-e89b-12d3-a456-426614174000",
  "concept_ids": [
    "c1-uuid-...",
    "c2-uuid-..."
  ],
  "config": {
    "question_types": [
      { "type": "MCQ", "count": 5 },
      { "type": "SHORT_ANSWER", "count": 3 },
      { "type": "LONG_ANSWER", "count": 1 }
    ],
    "difficulty_distribution": {
      "easy": 30,
      "medium": 50,
      "hard": 20
    }
  }
}
```

---

## 2. Response Format

The backend should return the list of generated questions. Each question object must follow a strict schema depending on its type.

### JSON Schema

```json
{
  "success": true,
  "message": "Successfully generated 9 questions.",
  "data": {
    "questions": [
       // List of Question Objects (see below)
    ]
  }
}
```

### Common Question Fields (All Types)

Every question object in the `questions` array must have these fields:

| Field | Type | Description |
|---|---|---|
| `id` | UUID | The unique ID of the question (generated by backend/DB). |
| `text` | string | The main question text/stem. |
| `type` | string (enum) | The type of question (MCQ, SHORT_ANSWER, etc.). |
| `marks` | integer | default marks assigned (e.g. 1 for MCQ, 5 for Long). |
| `hardness` | string | "easy", "medium", "hard". |
| `answer` | string | The correct answer key or model answer. |
| `explanation` | string | Detailed explanation of the answer. |
| `concept_ids` | Array[string] | ID(s) of the concept(s) this question tests. |

---

## 3. Specific Question Structures

### Type: MCQ

**Additional Fields:**
*   `options`: Array of option objects.

**Output Example:**
```json
{
  "id": "gen-q-uuid-1",
  "type": "MCQ",
  "text": "What represents the rate of change of velocity?",
  "marks": 1,
  "hardness": "easy",
  "options": [
    { "id": "opt-1", "text": "Speed", "isCorrect": false },
    { "id": "opt-2", "text": "Acceleration", "isCorrect": true },
    { "id": "opt-3", "text": "Displacement", "isCorrect": false },
    { "id": "opt-4", "text": "Momentum", "isCorrect": false }
  ],
  "answer": "Acceleration",
  "explanation": "Acceleration is defined as the rate at which an object changes its velocity.",
  "concept_ids": ["concept-uuid-1"]
}
```

### Type: TRUE_FALSE

**Output Example:**
```json
{
  "id": "gen-q-uuid-2",
  "type": "TRUE_FALSE",
  "text": "The mitochondria is the powerhouse of the cell.",
  "marks": 1,
  "hardness": "easy",
  "options": [
    { "id": "tf-1", "text": "True", "isCorrect": true },
    { "id": "tf-2", "text": "False", "isCorrect": false }
  ],
  "answer": "True",
  "explanation": "Mitochondria generate most of the chemical energy needed to power the cell's biochemical reactions.",
  "concept_ids": ["concept-uuid-2"]
}
```

### Type: SHORT_ANSWER

**Output Example:**
```json
{
  "id": "gen-q-uuid-3",
  "type": "SHORT_ANSWER",
  "text": "Define photosynthesis.",
  "marks": 2,
  "hardness": "medium",
  "options": [], 
  "answer": "Photosynthesis is the process by which green plants and some other organisms use sunlight to synthesize foods with the help of chlorophyll.",
  "explanation": "Key points: sunlight, chlorophyll, synthesis of food.",
  "concept_ids": ["concept-uuid-3"]
}
```

### Type: FILL_IN_THE_BLANK

**Format Note:** Use `_______` (7 underscores) or a standard placeholder for the blank in the text.

**Output Example:**
```json
{
  "id": "gen-q-uuid-4",
  "type": "FILL_IN_THE_BLANK",
  "text": "The chemical symbol for Gold is _______.",
  "marks": 1,
  "hardness": "medium",
  "options": [],
  "answer": "Au",
  "explanation": "Au comes from the Latin word 'Aurum'.",
  "concept_ids": ["concept-uuid-4"]
}
```

### Type: LONG_ANSWER

**Output Example:**
```json
{
  "id": "gen-q-uuid-5",
  "type": "LONG_ANSWER",
  "text": "Explain the impacts of the Industrial Revolution on urbanization.",
  "marks": 5,
  "hardness": "hard",
  "options": [],
  "answer": "The Industrial Revolution led to rapid urbanization as people moved from rural areas to cities in search of work in factories...",
  "explanation": "Answers should touch upon: shift from agrarian economy, rise of factories, overcrowding in cities, development of infrastructure.",
  "concept_ids": ["concept-uuid-5"]
}
```
